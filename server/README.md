# üñ•Ô∏è Cherry Charm Server

Backend —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –±–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π Cherry Charm —Å–ª–æ—Ç-–º–∞—à–∏–Ω–∏.

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
cd server
npm install
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
```bash
# –°–∫–æ–ø—ñ—é–π—Ç–µ .env —Ñ–∞–π–ª –∑ –∫–æ—Ä–µ–Ω–µ–≤–æ—ó –ø–∞–ø–∫–∏ –∞–±–æ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π
cp ../.env .env

# –ê–±–æ —Å–∫–æ–ø—ñ—é–π—Ç–µ –ø—Ä–∏–∫–ª–∞–¥ —Ç–∞ –∑–∞–ø–æ–≤–Ω—ñ—Ç—å
cp .env.example .env
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –†–æ–∑—Ä–æ–±–∫–∞ (–∑ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º)
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm start
```

### 4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
```bash
npm test
```

## üìã API Endpoints

### Health Check
```
GET /health
```
–ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å—Ç–∞–Ω —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–ª–æ–∫—á–µ–π–Ω—É.

### –ë–∞–ª–∞–Ω—Å –≥—Ä–∞–≤—Ü—è
```
GET /api/balance/:address
```
–û—Ç—Ä–∏–º—É—î –ø–æ—Ç–æ—á–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π –±–∞–ª–∞–Ω—Å –≥—Ä–∞–≤—Ü—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `address` - Ethereum –∞–¥—Ä–µ—Å–∞ –≥—Ä–∞–≤—Ü—è

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "data": {
    "address": "0x...",
    "balance": 150,
    "balanceWei": "1500000000000000000",
    "balanceIRYS": "1.5"
  }
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä–∏
```
POST /api/game-result
```
–û–±—Ä–æ–±–ª—è—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä–∏ —Ç–∞ –æ–Ω–æ–≤–ª—é—î –±–∞–ª–∞–Ω—Å –≥—Ä–∞–≤—Ü—è –≤ –±–ª–æ–∫—á–µ–π–Ω—ñ.

**–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:**
```json
{
  "playerAddress": "0x...",
  "betAmount": 5,
  "winAmount": 21,
  "gameData": {
    "fruit0": "CHERRY",
    "fruit1": "CHERRY", 
    "fruit2": "CHERRY",
    "timestamp": 1704067200000
  }
}
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "data": {
    "playerAddress": "0x...",
    "netChange": 16,
    "newBalance": 166,
    "newBalanceIRYS": "1.66",
    "txHash": "0x...",
    "reason": "win-CHERRY-CHERRY-CHERRY",
    "gameData": {
      "fruits": ["CHERRY", "CHERRY", "CHERRY"],
      "bet": 5,
      "win": 21,
      "timestamp": 1704067200000
    }
  }
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É
```
GET /api/stats
```
–û—Ç—Ä–∏–º—É—î –∑–∞–≥–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "data": {
    "totalDeposited": "10.5",
    "contractBalance": "8.3",
    "minDeposit": "0.005",
    "isPaused": false,
    "network": "testnet",
    "contractAddress": "0x..."
  }
}
```

## üîí –ë–µ–∑–ø–µ–∫–∞

### Rate Limiting
- **–ó–∞–≥–∞–ª—å–Ω–∏–π**: 100 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ 15 —Ö–≤–∏–ª–∏–Ω –Ω–∞ IP
- **–Ü–≥—Ä–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏**: 30 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É –Ω–∞ IP

### –í–∞–ª—ñ–¥–∞—Ü—ñ—è
- –í—Å—ñ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Joi
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É Ethereum –∞–¥—Ä–µ—Å
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —á–∞—Å–æ–≤–∏—Ö –º—ñ—Ç–æ–∫ (—Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω—ñ—Å—Ç—å 1 —Ö–≤–∏–ª–∏–Ω–∞)
- –°–µ—Ä–≤–µ—Ä–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤ –≤–∏–≥—Ä–∞—à—ñ–≤

### –ó–∞—Ö–∏—Å—Ç
- Helmet.js –¥–ª—è HTTP –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –±–µ–∑–ø–µ–∫–∏
- CORS –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –ø–æ–º–∏–ª–æ–∫

## üéÆ –õ–æ–≥—ñ–∫–∞ –≥—Ä–∏

### –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∏–≥—Ä–∞—à—ñ–≤
–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –≤–∏–≥—Ä–∞—à—ñ–≤ –∫–ª—ñ—î–Ω—Ç–∞:

```javascript
const calculateWin = (fruit0, fruit1, fruit2) => {
  if (fruit0 === 'CHERRY' && fruit1 === 'CHERRY' && fruit2 === 'CHERRY') return 21;
  if (fruit0 === 'CHERRY' && fruit1 === 'CHERRY') return 16;
  if (fruit0 === 'APPLE' && fruit1 === 'APPLE' && fruit2 === 'APPLE') return 8;
  if (fruit0 === 'APPLE' && fruit1 === 'APPLE') return 4;
  if (fruit0 === 'BANANA' && fruit1 === 'BANANA' && fruit2 === 'BANANA') return 6;
  if (fruit0 === 'BANANA' && fruit1 === 'BANANA') return 2;
  if (fruit0 === 'LEMON' && fruit1 === 'LEMON' && fruit2 === 'LEMON') return 3;
  return 0;
};
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤–∞–ª—é—Ç
- **1 IRYS = 100 —ñ–≥—Ä–æ–≤–∏—Ö –º–æ–Ω–µ—Ç**
- –í—Å—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –≤ –º–æ–Ω–µ—Ç–∞—Ö
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ wei –¥–ª—è –±–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π

## üìä –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–µ—Ä–≤–µ—Ä –ª–æ–≥—É—î –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó:
- –ó–∞–ø–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API
- –ë–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
- –ü–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —ñ–≥–æ—Ä

–õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –ø–∞–ø—Ü—ñ `logs/`:
- `combined.log` - –≤—Å—ñ –ª–æ–≥–∏
- `error.log` - —Ç—ñ–ª—å–∫–∏ –ø–æ–º–∏–ª–∫–∏

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
```env
# –°–µ—Ä–≤–µ—Ä
PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# –ë–ª–æ–∫—á–µ–π–Ω
IRYS_RPC_URL=https://testnet-rpc.irys.xyz/v1/execution-rpc
CONTRACT_ADDRESS=0x...
SERVER_WALLET_KEY=0x...

# –ë–µ–∑–ø–µ–∫–∞
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### –ü—Ä–æ–¥–∞–∫—à–Ω –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `NODE_ENV=production`
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HTTPS
- –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –ø—Ä–æ–∫—Å—ñ (nginx)
- –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (PM2)

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏
```bash
npm test
```

### –†—É—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
```bash
# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev

# –í —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ
curl http://localhost:3001/health
```

## üö® –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### –¢–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫
- **400 Bad Request**: –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ
- **429 Too Many Requests**: –ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ –ª—ñ–º—ñ—Ç –∑–∞–ø–∏—Ç—ñ–≤
- **500 Internal Server Error**: –ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞/–±–ª–æ–∫—á–µ–π–Ω—É
- **503 Service Unavailable**: –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–∏–∑—É–ø–∏–Ω–µ–Ω–æ

### –ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ–º–∏–ª–æ–∫
```json
{
  "success": false,
  "error": "Insufficient balance for bet"
}
```

## üîÑ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î API –∫–ª—ñ—î–Ω—Ç (`src/utils/api.ts`) –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ —Å–µ—Ä–≤–µ—Ä–æ–º:

```typescript
import { apiClient } from '../utils/api';

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≥—Ä–∏
const response = await apiClient.submitGameResult({
  playerAddress: '0x...',
  betAmount: 5,
  winAmount: 21,
  gameData: {
    fruit0: 'CHERRY',
    fruit1: 'CHERRY',
    fruit2: 'CHERRY',
    timestamp: Date.now()
  }
});
```

## üìà –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É
- –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API
- –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å –±–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- –ü–æ–º–∏–ª–∫–∏ —Ç–∞ —ó—Ö —á–∞—Å—Ç–æ—Ç–∞

### –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
- **PM2** –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å–∞–º–∏
- **Winston** –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è (–≤–∂–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ)
- **Prometheus** –¥–ª—è –º–µ—Ç—Ä–∏–∫
- **Grafana** –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó

## üõ†Ô∏è –†–æ–∑—Ä–æ–±–∫–∞

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö endpoints
1. –î–æ–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ `server.js`
2. –°—Ç–≤–æ—Ä—ñ—Ç—å —Å—Ö–µ–º—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó Joi
3. –î–æ–¥–∞–π—Ç–µ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫
4. –û–Ω–æ–≤—ñ—Ç—å API –∫–ª—ñ—î–Ω—Ç
5. –î–æ–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É
```
server/
‚îú‚îÄ‚îÄ server.js          # –û—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä–Ω–∏–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ test-server.js      # –¢–µ—Å—Ç–∏ API
‚îú‚îÄ‚îÄ package.json        # –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îú‚îÄ‚îÄ .env.example        # –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ logs/              # –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
‚îî‚îÄ‚îÄ README.md          # –¶—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```

## üéØ –ì–æ—Ç–æ–≤–æ!

–°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤–∏–π –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –±–ª–æ–∫—á–µ–π–Ω —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π Cherry Charm! üé∞